<script class="remote-markdown">
  function processMarkdown(url, text) {
    var markdownPath = url.substring(0, url.lastIndexOf("/") + 1);
    var markdownHostname = $('<a>').attr('href', url).prop('origin');
    var converter = new showdown.Converter();
    converter.setOption('ghCompatibleHeaderId', true);
    var html = $(converter.makeHtml(text));
    var $html = html.wrapAll('<p>').parent();

    $('[href][href!=""]:not([href*="://"])', $html).each(function() {
      var originUrl = $(this).attr('href');
      if (originUrl[0] == '/') {
        $(this).attr('href', markdownHostname + originUrl);
      } else {
        $(this).attr('href', markdownPath + originUrl);
      }
    });

    $('[src][src!=""]:not([src*="://"])', $html).each(function() {
      var originUrl = $(this).attr('src');
      if (originUrl[0] == '/') {
        $(this).attr('src', markdownHostname + originUrl);
      } else {
        $(this).attr('src', markdownPath + originUrl);
      }
    });

    if ($('.sidebar__right').length) {
      $('.sidebar__right').after(html);
      $('.sidebar__right > .toc').append('<ul class="toc__menu" id="markdown-toc">');
      $('.page__content').children('h2').each(function() {
        $('.toc__menu').append('<li><a href="#' + $(this).attr('id') + '" id="markdown-toc-' + $(this).attr('id') + '">' + $(this).text());
      });
      $(".toc__menu a").smoothScroll({offset: -20});
    } else {
      $('.page__content').prepend(html);
    }
    $('.page__content').children('h1').remove();
  }

  function getRemoteMarkdown() {
    var markdownUrl = '{{ include.target }}';
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
      if (xmlHttp.readyState == 4) {
        if (xmlHttp.status == 200) {
          processMarkdown(markdownUrl, xmlHttp.responseText);
        } else {
          $('.page__content').html('<div>Error in Request <a href="' + markdownUrl + '">Remote Doc');
        }
      }
    }
    xmlHttp.open("GET", markdownUrl, true);
    xmlHttp.send(null);
  }
</script>